<mat-card class="card" [class.vampire]="userService.appIsDark()" [class.angel]="!userService.appIsDark()">
    <mat-card-header>
        <mat-card-title>
            <h1 data-testid="header-title">Docker</h1>
        </mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <div class="commentgrid">
            <div class="topics">
                <div>
                    <ul>
                        <li>
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>Common Commands</mat-panel-title>
                                </mat-expansion-panel-header>
                                <br><label>builds a Docker image and tags it for uploading to <a
                                        href="https://hub.docker.dom">Docker
                                        Hub</a></label>
                                <code>docker build . -t &lt;dockerhub username&gt;/&lt;repo name&gt;:latest
                                </code>
                                <br><label>Build the image + start the container</label>
                                <code>docker-compose up --build</code>
                                <br><label>Start/Stop the container</label>
                                <code>docker-compose up/down</code>
                                <br><label>Network info</label>
                                <code>docker network ls</code>
                                <br><label>Image info</label>
                                <code>docker images</code>
                                <br><label>Copy items to/from image</label>
                                <code>docker cp 16d4ac49e7bb:/app/html-report .</code>
                                <br><label>Remove stopped containers and unused images.
                                    The options -a removes everything.</label>
                                <code>docker system prune (-a)</code>
                                <br><label>Saves an image to a local file
                                    system</label>
                                <div>
                                    <label>Create new image with current changes (this merges volumes)</label>
                                    <code>docker commit 93afb54049db jenkins:2.440.3-1
                                         (the recommended approach is to update your dockerfile with everything required as that ensured full reproducibility)</code>
                                    <br><label>Saves an image as image.tar</label>
                                    <code>docker save --output image.tar jenkins:2.440.3-1</code>

                                </div>
                                <br><label>Loads a saved image (likely on a different
                                    machine if you're not publishing to dockerhub)</label>
                                <code>docker load --input image.tar</code>
                                <br><label>Lists running containers</label>
                                <code>docker container ps</code>
                                <br><label>Lists all containers (including stopped)</label>
                                <code>docker ps -a</code>
                                <br><label>Lists all containers
                                    tagged</label>
                                <code>docker image ls | grep nehsa/nehsanet</code>
                                <br><label>publish
                                    to Docker Hub</label>
                                <code>docker push &lt;dockerhub username&gt;/&lt;repo name&gt;:latest</code>
                                <br><label>pull from Docker Hub</label>
                                <code>docker pull nehsa/nehsanet:latest</code>
                                <br><label>Open bash prompt as root user</label>
                                <code>docker exec -it -u root jenkins /bin/bash</code>
                            </mat-expansion-panel>
                        </li>
                        <li>
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>Publishing to dockerhub</mat-panel-title>
                                </mat-expansion-panel-header>
                                <ol>
                                    <li>Setup account on <a href="https://hub.docker.com/">dockerhub</a></li>
                                    <li>Create dockerfile and docker-compose files</li>
                                    <li>
                                        <br><label>Verify it builds</label>
                                        <code>docker build . -t &lt;dockerhub username&gt;/&lt;repo
                                            name&gt;:latest</code>
                                    </li>
                                    <li>
                                        <br><label>Verify it runs</label>
                                        <code>docker-compose up</code>
                                    </li>
                                    <li>
                                        <code>docker push &lt;dockerhub username&gt;/&lt;repo
                                            name&gt;:latest</code>
                                    </li>
                                </ol>
                            </mat-expansion-panel>
                        </li>
                        <li>
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>Setting up Local Registry</mat-panel-title>
                                </mat-expansion-panel-header>
                                <ol>
                                    <li>Download the registry docker container: <a
                                            href="https://hub.docker.com/_/registry"
                                            target="_blank">https://hub.docker.com/_/registry</a>
                                        <code>
                                            docker pull registry
                                        </code>
                                    </li>
                                    <li>Run it:
                                        <code>docker run -d -p 5000:5000 --name registry registry:latest
                                        </code>
                                    </li>
                                    <li>Verify it's running:
                                        <code>docker logs -f registry</code>
                                    </li>
                                    <li>Push to it:
                                        <code>
                                            docker tag node:20 localhost:5000/&lt;tagname&gt;<br>
                                            docker push localhost:5000/&lt;tagname&gt;
                                        </code>
                                    </li>
                                    <li>Delete it from the local machine (for reference):
                                        <code>docker rmi localhost:5000/&lt;tagname&gt;</code>
                                    </li>
                                    <li>Pull from it:
                                        <code>docker pull localhost:5000/&lt;tagname&gt;</code>
                                    </li>
                                </ol>
                            </mat-expansion-panel>
                        </li>
                        <li>
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>Install latest Python on Ubuntu (within Docker)</mat-panel-title>
                                </mat-expansion-panel-header>
                                Update dockerfile:
                                <code>
                                    <pre>
# Update package lists
RUN apt update && \
    apt upgrade -y

# Install required packages
RUN apt install -y python3.11  

# Check the installed version of Python
RUN python3.11 --version
</pre>
                                </code><br><br>
                                This can be verified by checking build log and confirmed we get a Python version 3.11
                                printed:
                                <img src="../../../assets/images/python-docker.png" alt="Python 3.11 installed" />

                            </mat-expansion-panel>
                        </li>
                        <li>
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>Example Files</mat-panel-title>
                                </mat-expansion-panel-header>
                                <ul>
                                    <li>
                                        <mat-expansion-panel>
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>dockerfile</mat-panel-title>
                                            </mat-expansion-panel-header>
                                            <code>
                                                <pre>
FROM node:21.6.1-slim  <span class="comment">// The base image to start with</span>
EXPOSE 80 443
WORKDIR /app 
COPY package.json . 
RUN npm install
COPY . .
CMD node index.js
</pre>
                                            </code>
                                        </mat-expansion-panel>
                                    </li>
                                    <li>
                                        <mat-expansion-panel>
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>docker-compose.yml</mat-panel-title>
                                            </mat-expansion-panel-header>
                                            <code>
<pre>
name: nehsanet
version: "3.8"
services:
    nehsanet:
    build: .
    ports:
        - "0.0.0.0:4200:4200"
        - "0.0.0.0:49153:49153"
    image: "nehsanet-image"
    volumes:
    - "/app/node_modules"
    - ".:/app"
    command: bash -c "npm install -D &#64;playwright/test&#64;latest --legacy-peer-deps; npx playwright install --with-deps msedge firefox webkit; npm start -- --host 0.0.0.0"
volumes:
    node_modules:
    app:                       
</pre>
                                            </code>
                                        </mat-expansion-panel>
                                    </li>
                                    <li>
                                        <mat-expansion-panel>
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>Development within a container</mat-panel-title>
                                            </mat-expansion-panel-header>
                                            <ul>
                                                <li>
                                                    If you're using WSL2:
                                                    <ul>
                                                        <li>Open VS code</li>
                                                        <li>Connect to running container</li>
                                                        <li>Open /app folder</li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </mat-expansion-panel>
                                    </li>
                                </ul>
                            </mat-expansion-panel>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3>Other tidbits..</h3>
                    <ul>
                        <li>You do not need to enter entire hash for an image/container as long as they're using. e.g.
                            418 would find this image:
                            <pre>
PS C:\src\nehsa.net> docker image ls | grep nehsa/nehsanet
nehsa/nehsanet   latest    418b390c6d3a   26 minutes ago   3.2GB
</pre>
                        </li>
                        <li>Anything not in a &quot;volume&quot; will be lost the next time the container is started
                            until the image is updated (docker build)</li>
                        <li>Containers can be started using either:
                            <ul>
                                <li>a sole dockerfile and <code>docker run -p 80:80 -it
                                        nehsa/nehsanet:latest</code>
                                </li>
                                <li>a dockerfile and docker-compose.yml and <code>docker compose
                                        up/down</code>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
            <div><app-comment></app-comment></div>
        </div>
    </mat-card-content>
</mat-card>